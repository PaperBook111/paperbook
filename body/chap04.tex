\chapter{大型RFID系统中未知标签的快速识别}
\echapter{Unknown Tag Identification in RFID system}
\label{chap03}
数以百万计的RFID设备已经应用于智慧图书馆、智能仓储、供应链、无人值守超市和机场等需要物品盘点、商品追踪、防伪等功能的大型场所\ucite{yu2017finding,su2021efficient,YinShoujun2019}。相对于二维码一次识别单个目标的功能，RFID技术具有更高的识别效率、长距离/多目标识别、非视距通信等优点\ucite{su2020time,dong2020improved,xie2019fast}。未知标签识别是RFID系统研究的基础问题之一。未知标签的存在可能会给供应链系统、仓储管理等带来不可忽略的经济损失或安全隐患\ucite{gong2017efficient,liu2015sampling}，比如有毒有害物品不慎混入食品储藏区，或由于温度、湿度、光照、人员管理疏忽等因素影响，导致有毒有害物品的挥发，给食品安全带来重大隐患。因此及时发现危险物品显得尤为重要，未知标签识别问题具有重要研究价值。

现有的商用RFID设备关于标签识别的协议通常基于C1G2通信标准设计\ucite{chen2018using,fu2017fast,zhu2016efficient}。在C1G2通信标准中，阅读器根据标签数量选择一个最优时间帧长度，并把此参数广播传送给需要识别的标签，标签利用哈希函数随机选择一个时隙回复阅读器问询\ucite{guo2021priority}。当有多个标签选择同一个时隙回应时，该时隙为冲突时隙，冲突时隙中阅读器收到的信息是多个标签回应的融合信息，而阅读器不能从融合信息中提取任何一个标签回应信息。因此，在未知标签识别中，冲突时隙会被直接废弃\ucite{lin2021fast,shahzad2015expecting,chen2017efficient}。 但废弃的冲突时隙同样需要时间来验证冲突时隙状态，导致冲突时隙的产生降低了未知标签的识别效率与时隙利用率。为减少冲突时隙的比例，传统协议通常需要设置较大的帧长，同样带来未知标签识别效率低问题。

在含有未知标签的RFID系统中，已知标签的存在会影响未知标签的识别效率\ucite{liu2014efficient}。在未知标签识别协议执行前，每个已知标签所选响应时隙可以通过帧长、标签ID以及哈希种子预测得到。如果预测一个时隙没有标签响应，但在协议执行时该时隙有标签响应，则可断定该响应标签为未知标签，且当该响应标签只有一个时，则该标签ID可以被顺利读取。如果未知标签选择一个有已知标签响应的时隙时，未知标签就不能被识别。因此，已知标签的存在严重制约未知标签的识别效率\ucite{liu2014unknown}。在传统未知标签识别协议中，已知标签灭活效率同样也是协议执行效率的重要衡量标准。

本章主要研究了大规模RFID系统未知标签识别问题中冲突时隙再利用以提升时隙利用率和未知标签识别效率。本章提出了冲突分解法（Conflict Resolution Method，CRM），该协议引入区分码改进传统RN16 (16-bit Random or pseudo-random Number)，使RN16不仅具备传统的冲突检测功能，也具备冲突时隙内冲突标签区分功能。CRM把大部分的冲突时隙转变为有用时隙，将没有未知标签参与的冲突时隙内的已知标签灭活，对有未知标签参与的冲突时隙进行区分码的解缠绕，以提取并识别冲突时隙中的未知标签。理论分析和数值仿真结果证明CRM相对于已有协议对未知标签的识别效率有显著提升。


本章的主要内容和结构安排如下，第\ref{problem_definition_dts}节阐述了未知标签识别问题的明确定义，并给出了RFID问题研究的系统模型。
%
第\ref{PriorArtlimitation_dts} 节阐述了相关的研究工作，并指出了本章内容的主要挑战。
%
第\ref{C1G2_based}节介绍了阅读器与标签通信相关指令的C1G2标准。
%
第\ref{CRM_protocol}节说明了冲突分解法的设计。
%
第\ref{Optimize_parameters} 节优化CRM的参数，使CRM的执行时间最短、性能达到最优。
%
第\ref{Other applications for CRM} 节说明CRM的有点及CRM在RFID研究中的其他应用。
第\ref{performanceEvaluation_dts} 节利用仿真实验，通过调整各参数变化对比CRM与其他协议的执行性能，实验结果证明CRM在未知标签识别面能显著提升时间效率。
第\ref{Conclusion_dts}节总结了本章的研究工作。

\section{问题定义与系统模型}\label{problem_definition_dts}
\esection{Problem Definition}
\subsection{问题描述}
假设已知的标签组为$S=\{a_1,a_2,\dots,a_n\}$，待检测标签组为$T=\{t_1,t_2,\dots,t_N\}$。$S$和$T$的数量分别为$n$和$N$。$n$已知且$S$中的所有标签ID存储在后台服务器，阅读器可以访问后台数据库中已知标签ID信息。$N$未知且$N\geq n$，因此RFID系统中出现的未知标签数量为$u(u=N-n)$。 未知标签识别的目的是找出待测标签组$T$中包含的未知标签，并读取其ID信息。在一个识别可靠度为$\omega$的RFID系统中，$(\omega \in [0.1))$，至少需要识别出的未知标签数量为$\omega \times u$，也就是说未被识别的未知标签数量为$m$，且$m\leq (1-\omega)\times u$。此CRM协议的目的是最小化执行时间。

\subsection{系统模型}
\begin{figure}[t]
    \setlength{\abovecaptionskip}{0pt}
    \setlength{\belowcaptionskip}{0pt}
  \centering
  \includegraphics[width=0.5\textwidth]{UnknownTags111}
  \bicaption[UnknownTags111]{}{含有未知标签的RFID系统模型}{Fig.}{Unknown tags existed RFID system.}
\end{figure}
一个典型的RFID系统包含标签、阅读器和后台服务器3个部分。每个标签拥有一个独一无二的识别ID（可被读/写），ID的长度一般为96位，且系统内所有标签存储一个相同的哈希函数$\mathcal{H}(\cdot)$。后台服务器存储标签ID信息，并可根据ID信息实现多样化的业务需求。因此，标签根据其ID是否被收录可分为已知标签和未知标签。阅读器可获取标签ID，是链接标签与后台服务器的高速通道，阅读器与后台服务器可统称为阅读器。单个阅读器的读取距离为$5m\sim 12m$，因此，一个较大范围内标签的识别监控需要多台阅读器交叉协同工作。而每个阅读器都会收到1个标签反馈数组，后台服务器对所有反馈数组进行位或运算，即可获取1个融合反馈字符串数组\ucite{xie2019fast}。因此，RFID系统中所有阅读器可以被看作1个超强阅读器，如图~\ref{UnknownTags111}所示。所有标签均在此超强阅读器识别范围内，阅读器周期询问识别范围内的标签，并搜集标签反馈信息。


%大规模的RFID系统通常包含依据所有权、品牌、价值或危险系数等指标划分的多个附带标签的物品群组。价值越高、危险系数越高的物品一般会更受关注，在识别过程中，此类物品应先于其他物品完成识别，更快的完成盘点。然而，现有标签识别协议只能对标签实现逐一类别激活、逐一类别识别的功能。这样虽然保证了受关注物品的优先识别，但其他类别物品识别时间就要推迟，识别效率受到损害，且在识别过程中，标签冲突现象不能得到缓解，时隙利用率低仍然制约各个类别标签的识别效率。

%在不损害各个标签类别识别效率的前提下，为了提高高优先级类别标签的识别效率，冲突时隙的再利用成为解决问题的突破口。然而传统的基于EPC C1G2 标准的Aloha协议中冲突时隙被废弃的直接原因是冲突信号无法解调为分属冲突标签的单一信号，且冲突时隙的最小比例为26.4\%。因此本章研究了改进的Aloha协议，使冲突时隙变为伪单一时隙重新激活冲突时隙内的最高优先级标签，增大了高优先级标签的识别概率和时隙利用率。

%假设一个RFID系统有$w$个类别标签，且每个标签都有惟一的标识ID，标识ID由两部分组成：优先级ID(PID)和成员ID。一个PID中只有一位是$1$，其他位全是$0$。PID中“1”的索引标识优先级的高低，当$1$从左到右移动时，优先级下降。例如，PID-100的优先级高于PID-001。PID的长度为$w$，对应的，成员ID 的长度为$(96-w)$。因此，总共$N$个标签被随机分为$w$个不同的优先级群组。每个优先级群组中的标签数量分别为$=\{n_1, n_2，\dots, n_w\}$。本章专注于以个性识别效率识别每个优先级群组中的所有标签，优先级高的群组享有更高的识别效率。


\section{现有方案及其不足}\label{PriorArtlimitation_dts}
\esection{Existing Art and Limitation}

\subsection{相关工作}
\esubsection{Related Work}
\begin{figure}[t]
    \setlength{\abovecaptionskip}{0pt}
    \setlength{\belowcaptionskip}{0pt}
  \centering
  \includegraphics[width=0.5\textwidth]{DFSA}
  \bicaption[DFSA]{}{DFSA中阅读器的操作}{Fig.}{The operation of reader in DFSA.}
\end{figure}
现有的能够解决未知标签识别的协议可以分为标签识别\ucite{guo2021priority,fu2017fast,chen2018using,su2020partitioning,wang2021time}、未知标签检测\ucite{liu2020fast,gong2017efficient,liu2015sampling}、未知标签识别\ucite{su2020partitioning,qian2016tip,zhu2017efficient}3 类。这3 内协议目前主要存在以下3个不足：
\begin{asparaenum}
\item 标签识别旨在收集RFID系统中标签ID信息，通过对比收集到的标签ID与服务器中存储的已知标签ID，即可发现未知标签；虽然这种协议可以实现未知标签识别，但需要收集所有RFID系统中标签ID信息，因此时效性较低。
\item 未知标签检测协议意在检测RFID系统是否存在未知标签，不必获取未知标签ID信息，因此通常使用概率的方法来优化协议参数设置，但在检测中会出现假阴性错误，即未知标签的反馈信息被已知标签覆盖，导致未知标签检测失败。
\item 未知标签识别协议旨在收集RFID系统中未知标签ID信息，但为了减少已知标签干扰，通常会把已知标签灭活，由于假阴性错误存在，未知标签可能会被误认为已知标签而被灭活。因此，减少假阴性出现概率成为未知标签识别协议中不可忽略的问题。
\end{asparaenum}

现有标签识别协议PTI\ucite{guo2021priority}通过设置标签优先级，以及改造RN16规则，实现冲突时隙中获取最高优先级标签ID的功能，PTI把部分冲突时隙变为有用时隙，但PTI不能针对性的识别冲突时隙内的未知标签，且对已知标签灭活效率低下。TES-FAS\ucite{fu2017fast}通过快速估测算法，实时调整时间帧长来提高标签识别效率，但TES-FAS无法实现冲突时隙内标签识别。BRTP\ucite{chen2018using}是基于曼彻斯特编码的二叉树算法，把待识别的标签逐步分成更小的群体直至每个群体内只剩一个标签，从而达到标签识别的目的，但二叉树算法识别效率仍需提高。MAP\ucite{su2020time}是基于标准时隙Aloha协议的算法，MAP能够把时隙利用率提升到36\%，但在协议执行中，冲突时隙仍然是制约标签识别效率的最大因素。SIP\ucite{dong2020improved} 利用阻塞标签的协助来识别特定标签，阻塞标签可以有效保护用户隐私，但同样增加了标签识别的负担，使冲突时隙数量增多，导致标签识别效率降低。BFI\ucite{xie2019fast}识别附着多个标签的物体，虽然有部分标签能通过标签相关性过滤掉，但冲突时隙仍然是不能回避的问题。

 现有的未知标签检测协议CSD\ucite{liu2020fast}充分利用服务器性能计算合适的哈希种子，使已知标签映射入特定位置的时隙中，从而实现绝大部分的时隙为空时隙，在实际映射中，如果空时隙变为单一时隙或冲突时隙，则表明RFID系统中有未知标签存在，CSD虽然在协议执行时有很高的检测效率，但协议执行前，需要耗费大量时间寻找合适的哈希种子，且在协议执行过程中，不能灭活已知标签来降低干扰。WP\ucite{gong2017efficient}利用多哈希的方式把时间帧中的时隙状态全变为空时隙，如果有未知标签出现，则相应时隙会变为单一时隙或冲突时隙，虽然未知标签检测的复杂度降低，但是多哈希的运算，以及每个时隙哈希种子的设定都需要阅读器发送额外的数据到标签这导致了WP检测效率的延迟。SBF-UDP\ucite{liu2015sampling}利用采样和布隆过滤器，减少参与检测标签的数量，以及过滤已知标签来增大未知标签检测的概率，但布隆过滤器的使用同样需要多次哈希运算来完成。

本文旨在提升未知标签识别的时隙利用率以及识别效率。现有未知标签识别协议有UTI-SBF\ucite{chen2018using}、HUTI\ucite{fu2017fast}、PUTI\ucite{zhu2016efficient}、FUTI\ucite{liu2014efficient}、MUIP\ucite{liu2014unknown}、TIP\ucite{qian2016tip} 等，都是基于标准Aloha设计，而动态帧时隙Aloha（Dynamic Frame Slotted Aloha，DFSA）协议是目前由EPC C1G2标准\ucite{epcc1g2}指定的标准化解决方案。如图~\ref{DFSA}所示，DFSA的基本思想是首先采用标签估测方法(Tag Estimation Method，TEM)\ucite{cha2006dynamic}来估计标签的数量，利用估测的标签数量优化时间帧的大小，进而优化时隙利用率提高已知标签灭活和未知标签识别效率。然而，他们均面临着冲突时隙不能被利用的共同问题。且由于已知标签灭活效率低，导致未知标签识别效率过低。为了减少或转化冲突时隙，ZHU等\ucite{zhu2016efficient}利用标签反馈的物理层信息判断一个时隙内标签响应的个数，再利用二次哈希的方式让冲突标签重新选择时隙，虽然这种方式可以转化部分冲突时隙为有用时隙，但一个没有未知标签响应的冲突时隙不能被有效灭活，已知标签的干扰仍然是造成未知标签识别效率低的主要原因。未知标签识别效率仍有提升的空间，且在实验中利用USRP获取标签响应的物理层信息，此种信息在商业RFID设备中无法获取。LIU等\ucite{liu2014efficient}利用多哈希方式构建过滤数组，过滤数组能高速过滤已知标签，使未知标签被识别的概率增大，然而针对全局的多次哈希运算要消耗大量的时间，冲突时隙也不可避免且无法被利用。LIU等\ucite{liu2014unknown}基于标准Aloha协议，快速灭活单一时隙中的已知标签，识别预测空时隙转变为单一时隙的未知标签，但冲突时隙仍然无法被利用，这降低了未知标签的识别效率。总而言之，冲突时隙不能被有效利用仍是造成未知标签识别效率低的不可忽视的原因。
%在本节中，我们将简要回顾一些关于标签识别的最具代表性的文章。动态帧时隙Aloha（Dynamic Frame Slotted Aloha，DFSA）协议是目前由EPC C1G2 标准\ucite{epcc1g2}指定的标准化解决方案。如图~\ref{DFSA}所示，DFSA的基本思想是首先采用标签估测方法(Tag Estimation Method，TEM)\ucite{cha2006dynamic}来估计标签的数量，利用估测的标签数量优化时间帧的大小，进而优化时隙利用率提高标签识别效率。一些最近的研究工作试图提升轻量级估测器的准确性。例如，陈等人采用最大后置概率方法MAP（Maximum a Posteriori Probability）获得更准确的待测标签群大小的估定值\ucite{chen2017efficient}，提高吞吐量来优化的时间开销。然而，即使在最优的参数设置条件下，由于不可避免的标签冲突，DFSA的吞吐量（时隙利用率）仍被限制在其理论最大值$36.8\%$。时隙利用率低仍然是制约标签识别效率的主要因素。

%为了进一步提高时隙的利用率，一些协议选择跳过空时隙，迁移冲突时隙。预留时隙的多位Aloha协议(RSMBA)\ucite{yihong2013multiple}提出了一中两相步法跳过冲突时隙和空时隙。具体来说，第一阶段观察时隙状态，阅读器允许标签响应一条短消息以识别时隙类型，为了跳过无用的时隙，阅读器立即标记冲突时隙中的标签并且重建单一时隙中的标签索引；第二阶段识别阶段，阅读器只对重新建立索引的单一时隙问询并获取标签ID。同样的，何等人提出了一种改进的防冲突算法，该算法不仅能识别冲突时隙，还能利用补充的空时隙重新索引冲突标签\ucite{he2013aloha}。虽然这些协议大幅提高了时隙利用率，但均需标签发送额外的数据区分时隙状态，且协议执行时，所有的标签无论关联物品属性均等分配时隙资源，各个标签享有相同的识别概率。
%复杂的逻辑操作序列给RFID标签带来了大量的计算负担，难以集成到目前的C1G2标准中，且协议执行时，所有的标签无论关联物品属性均等分配时隙资源，各个标签享有相同的识别概率。

%总而言之，所有的相关工作都忽略了标签识别中的群体个性化问题，我们率先将差异的识别效率分配到不同的优先级群体。



%文献\ucite{JueWangLowPower}提出了一个并行标签识别协议Buzz，利用稀疏编码以及压缩感知技术，可以对冲突时隙中阅读器传送的信息进行解码。
%%
%因为标签可以利用冲突时隙传送效率，系统的吞吐率得到了大幅度的提高。此外，传输的速率可以根据信道的状况动态调整。Buzz协议假设每个标签选择的时隙是可预测的，并且需要一些自定义命令的支持。
%%
%因此，Buzz协议只能使用可编程RFID 设备实现（例如，WISP标签和USRP阅读器），不能在现有的商用设备上部署。
%%
%文献\ucite{liu2015fast}提出了一个分组协议GCC，可以将标签按照其价值等特性进行分组。分组之后，我们可以对每组标签运行不同的策略，从而实现个性化的监控。
%%
%但是GCC为了节约传输开销，采用了轻量级的指导向量来进行分组信息的传输。但是指导向量同样需要WISP标签的支持不能在商用设备上实现。
%%
%现有的树状协议\ucite{AlexSigmetrics13HoppingTree} 常使用标签的EPC存储区进行标签选择和采样。
%%
%EPC存储区存储着被标记物品的96 位商品编码，阅读器可以通过\texttt{Select}命令，对具有特定EPC 片段的标签进行选择。
%%
%理论上来说利用我们可以利用EPC 存储区实现多类别标签的个性化抽样，但是这会带来大量的计算。阅读器必须在后端服务器上对各类标签进行抽样，找出被采样的标签。
%%
%然后搜寻一个合适的片段，令所有被采样的标签都有此片段，而所有未采样的标签都没有此片段。显然这样的EPC 片段不一定存在，即使存在也会带来很高的计算复杂度。
%%
%因此，现有的的协议都不能满足本章的设计目标，要么是不能在商用设备上实现，要么就是很难适应动态大规模系统实时监控的要求。
%%
%本文在对比实验时，主要与现有的商用阅读器所采用的阿罗哈协议进行对比。


\subsection{主要挑战}
\esubsection{Challenge Issues}
通过研究现有未知标签识别协议优缺点分析以及标签识别协议、未知标签检测协议中冲突时隙比例减小方法研究，我们发现基于传统帧时隙的Aloha协议中，冲突时隙无法被利用一直是制约协议性能提升的瓶颈因素。为增大时隙利用率，CRM把部分冲突时隙转变为可利用时隙，因此，CRM主要面临以下三个挑战亟待解决。

%通过分析现有的标签识别协议，我们发现对于包含多个群组的标签识别仍然采用逐个群组识别或无差别识别的方式。采用逐个群组识别时，当前群组识别过程中，其他群组只能等待，失去了各群组享有时隙资源的平衡。采用无差别识别方式时，各群组内的标签将会按照标签比例分配时隙，所有群组内的每个标签享有相同的识别概率，虽然保证了各群组时隙资源分配的公平性，但却不能满足各个群组不同的识别紧迫性需求。且在现有识别协议中，对于冲突时隙往往采用直接废弃的手段来提高识别的时间效率，但这反而成为制约时间效率提升的因素，因此，针对不同群组的时隙资源分配以及化解冲突时隙问题现有标签识别协议仍有较大的提升空间，主要有以下三个挑战亟待解决。
\begin{itemize}
  \item 首先，为了转化冲突时隙为可用时隙，如何区分冲突时隙内的冲突标签并把冲突时隙转变为伪单一时隙成为转化是否成功的关键。
  \item 其次，转化冲突时隙不可避免需要消耗更多的时间，且冲突时隙内的冲突标签越多转化越困难，如何选择低消耗的冲突时隙进行转化是提升协议执行性能要解决的关键问题。
  \item 最后，CRM中由于冲突时隙的再利用，简单的把时间帧长度设置为标签总量并不合理，优化时间帧长度可以使未知标签识别性能得到更大提升。
\end{itemize}


\section{阅读器与标签通信的C1G2标准简介}\label{C1G2_based}
\esection{Background of C1G2 Specification}

\subsection{C1G2标准背景简介}
商业RFID设备中阅读器与标签的通信通常遵照标准帧时隙的Aloha协议设定。其执行过程如图~\ref{CRM}{a}所示，一般需要执行多个时间帧才能完成设定任务，每个时间帧含有多个时隙。当一个时间帧开始时，阅读器首先向周围空间发送询问命令\texttt{Query}，并广播包括时间帧中时隙数量$f$、 哈希种子$r$的参数。一旦接收到\texttt{Query}命令，每个标签计算哈希函数并随机选择时间帧中的一个时隙作为自己的响应时隙，哈希函数为 $sc\!=\!\mathcal{H} (ID,s)\!\mod \!f$，其中$sc$为时隙计数器，且$sc\in[0,f)$，$\mathcal{H}(\cdot)$为一个预先存储在标签中的哈希函数，ID 为标签识别码。此后，阅读器逐个询问时间帧中的时隙，当一个时隙询问结束时，阅读器向当前时隙发送\texttt{slot end}命令结束访问并初始化下一时隙，而标签的时隙计数器$sc$收到命令后自动减1，当$sc$为0时，标签在接下来的时隙中向阅读器发送预定信息。当协议执行完毕后，所有的时隙可以分为三种状态：1）空时隙，没有标签选择该时隙；2）单一时隙，仅有一个标签选择该时隙回复阅读器询问；3）冲突时隙，有且多于一个标签选择该时隙回复阅读器询问。在标准Aloha协议中，阅读器对于不同状态的时隙采用不同的执行过程。对于空时隙，阅读器发送\texttt{Query}命令后，等待$(T_1+T_3)$后仍然没有标签响应，阅读器终止该询问并访问下一个时隙。对于单一时隙，阅读器发送\texttt{Query} 命令后，标签回复一个16 位的随机数RN16，阅读器返回标签一个包含该RN16信息的\texttt{ACK}命令，标签确认收到\texttt{ACK}命令中的RN16 与自己发送的RN16信息一致，则此标签回复预设信息返回阅读器，阅读器接收信息完毕则发送\texttt{kill}命令使对应标签沉默，不参与下一个时间帧的执行，并开始询问下一个时隙。对于冲突时隙，标签向阅读器发送RN16，RN16中包含循环冗余检验码(Cyclic Redundancy Check，CRC)，然而此时阅读器接收到的RN16 是多个RN16的融合，CRC 校验错误则认为此时隙为冲突时隙。在标准Aloha协议中，一个单一时隙、空时隙、以及冲突时隙所消耗的时间分别为：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{Prob_DetectASingleMissingTag}
\begin{aligned}
t_{sk}=2\times(T_1+T_2)+T_{RN16}+T_{QueryRep}+T_{kill},
\end{aligned}
\end{equation}
\end{small}
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{Prob_DetectASingleMissingTag}
\begin{aligned}
t_{se}=T_1+T_3+T_{QueryRep},
\end{aligned}
\end{equation}
\end{small}
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{Prob_DetectASingleMissingTag}
\begin{aligned}
t_{sl}=T_1+T_2+T_{RN16}+T_{QueryRep},
\end{aligned}
\end{equation}
\end{small}

我们假设阅读器与标签通信是在无干扰的条件下进行，根据C1G2标准设定\ucite{epcc1g2}，阅读器向标签发送数据的下行链路速率为26.5kb/s，而标签向阅读器发送数据的上行链路速率为53kb/s，也就是说阅读器向标签发送1-bit数据所用的时间为$12.5us$，而标签向阅读器发送1-bit数据所用时间为$6.25us$。 阅读器与标签通信的参数设定如表~\ref{tab:C1G2}所示。文中变量所表示的含义如表~\ref{tab:annotations}所示。

\begin{table}[t]
	\centering
    \bicaption[tab:C1G2]{}{基于C1G2的仿真参数设定}
    {Tab.}{The parameters setting based on C1G2}
	\begin{tabular}{cccc}
		\hline
		% after \\: \hline or \cline{col1-col2} \cline{col3-col4} ...
		参数 & 数值& 参数 & 数值\\
	   \hline
        $C_{RT}$& $26.5kb/s$ &$T_1$& $62.5us$\\
        $C_{TR}$& 53kb/s &  $T_2$& $62.5us$  \\
		Query& 22bits& $T_3$ & $50us$\\
		QueryRep& 4bits & $T_4$&  $100us$\\
		RN16& 16bits &$t_{sc}$&  $3.61ms$\\
        ACK& 18bits &$t_{sk}$&  $0.58ms$\\
        NAK& 8bits &$t_{se}$&  $0.26ms$\\
        Kill& 59bits &$t_{sl}$&  $3.19ms$\\
        EPC ID& 96bits &$t_{dc}$&  $0.80ms$\\
        DACK& kbits &$t_{ds}$&  $2.97ms$\\
        TACK& 18-kbits &$t_{dm}$&  $0.64ms$\\
        $T_{pri}$& 6.25us&$t_{dk}$&  $3.66ms$\\
		\hline
	\end{tabular}
\end{table}

\begin{table}[t]
	\centering
    \bicaption[tab:annotations]{}{主要符号及其注释}
    {Tab.}{The main notations and their annotations}
	\begin{tabular}{cc}
		\hline
		% after \\: \hline or \cline{col1-col2} \cline{col3-col4} ...
		变量 & 注释\\
	   \hline
        f& 每个时间帧中包含时隙数量 \\
		r& 哈希种子\\
		$n_i$& 第次检测仍存在的已知标签数量\\
        $N_i$& 第次检测仍存在的标签数量\\
        sc& 标签选择响应时隙 \\
        k& 区分码的长度\\
        x& 随机码的长度\\
        c& 一个时隙中标签选择的区分位 \\
        w& 一个时隙中响应标签的数量 \\
        $\lambda$& 协议执行一次所需要的哈希种子数量\\
        A& 一个时隙中区分位的实际映射情况\\
        Q& 一个时隙中区分位预测映射情况\\
        y& 实际映射中一个冲突时隙内未知标签数量\\
        z& 实际映射中一个冲突时隙内已知标签数量\\
        $T_{all}$& 协议执行时间\\
		\hline
	\end{tabular}
\end{table}



\subsection{相关C1G2命令简介}
为了解决上述三个挑战，本节首先提出冲突分解法（CRM），利用商用阅读器与标签通信的C1G2接口协议所规定的命令来实现未知标签识别。因为CRM所用命令都是挪用或改编C1G2标准命令，因此CRM可以在USRP（Universal Software Radio Peripheral）设备模拟实现，也可以对商用阅读器命令做轻微修改来实现。我们首先介绍RFID标签各存储区的功能和本节所使用的C1G2命令。
%
\begin{asparaenum}
\item \textbf{标签存储区简介：}C1G2标准要求阅读器与所有类型的标签的逻辑接口区定义一个统一制式的标签存储模型（C1G2规范\ucite{epcc1g2}44-51页所示）。标签的内存被逻辑分割为四个存储区：（i）预留存储区，用于存储标签验证密码，包括对\texttt{Kill}命令、以及\texttt{Acess}命令等阅读器指令的验证，如果不需验证，则验证密码可以为零值验证。
%
（ii）EPC存储区，用于存放标签的标识ID，StoredCRC，StoredPC和XPC word。ID的长度通常为96位，记录标签关联物品的类别，序号和生产商等信息；StoredCRC为信息校验码，验证阅读器与标签发送与接收到的信息是否正确；StoredPC设置能够存储的ID长度，XPC word为扩展协议控制。
%
（iii）TID储存区，TID为制造商定义标签规范并存储标签能够支持的函数，例如标签属性类别标识值ISO/IEC。
%
（iv）用户存储区，允许用户存储用户数据。通常根据任务需要划分为多个文件，利用C1G2中的\texttt{Write}和\texttt{Read}命令对此存储区进行读写操作。
%存储用户所需的数据。通常会被进一步划分成一个或多个文件。我们可以用C1G2支持的\texttt{Write}和\texttt{Read}命令对以下的存储区进行操作，通常每个\texttt{Write}/\texttt{Read}命令能够写入/读取两个字节的数据。
%
%在本节中，我们所使用的标签ID存储在EPC存储区，标签ID划分为优先级ID和成员ID，标签ID的总长度为96位，如果优先级ID的长度为$w$，且只能标识$w$ 个优先级，成员ID的长度为$96-w$。如果优先级的划分等级较多，则严重限制成员ID的长度，严重缩减成员数量。因此，当优先级划分等级较多时，用户存储区可以存储优先级ID，把96位ID长度全部归还给成员ID。在协议执行之前，每个标签的优先级ID需要提前设定完成。


\begin{table}[t]
	\centering
    \bicaption[tab:select]{}{\texttt{Select}命令的结构}
    {Tab.}{Structure of \texttt{Select} commands}
	\begin{tabular}{ccc}
		\hline
		% after \\: \hline or \cline{col1-col2} \cline{col3-col4} ...
		字段 & 位数& 功能\\
		\hline
		Target& 3 & 修改标签的\textbf{SL}或\textbf{inventoried}标记\\
		Action& 3 & 执行C1G2规范中表6.30定义的操作\\
		MemBank& 2 & Mask需要匹配的数据所在的MemBank分区\\
		Pointer& EBV & Mask所匹配的数据的起始地址\\
		Length& 8&  Mask的长度\\
		Mask& Variable & Mask的内容\\
		Truncate& 1& 是否截断标签回复的数据\\
		CRC& 16 & CRC-16检错检验码\\
		\hline
	\end{tabular}
\end{table}
\item \textbf{\texttt{SELECT}命令简介：}
C1G2标签规定由阅读器发送的\texttt{Select}命令能够实现标签筛选，允许用户自定义特征的标签参与标签识别任务。
标签应实现一个选定标记SL，阅读器可以使用\texttt{Select}命令决定该标记是否有效（Kill状态下的标签除外）。符合要求的标签将会被设置为活跃状态，否则为静默状态，只有活跃状态的标签才能参与到标签的识别任务。多个\texttt{Select}命令可以获取待识别活跃标签群组的合并和交集。如表\ref{tab:select}所示，\texttt{Select}命令包含8个字段。Target字段决定是否修改SL和inventoried标记，如果Target字段的值为$101_2,110_2,111_2$，则标签无视\texttt{Select}命令所要求的任何操作。Action字段规定执行Target字段指定的操作，CRM中Target字段设置为$100_2$，Action字段设置为$000_2$，指定操作如C1G2标准中表6.30所示\ucite{epcc1g2}，指定标签群体被激活将会参与标签识别过程，其他标签静默等待。MemBank指定Select命令执行任务类型，CRM中MemBank设置为$01_2$，则\texttt{Select}指定EPC存储区。Pointer字段指定Mask字段的起始位置，Pointer字段选用EBV格式。Length字段指定Mask字段的长度，Length字段的长度为8比特，允许Mask字符串的长度为0到255位。Mask字段为对比数据，如果\texttt{Select}命令中Mask中指定Pointer起始位的存储数据与EPC存储区数据匹配，则对应标签被激活，否则，标签静默等待下一轮指令来临。Truncate字段决定了标签回复Mask之后的EPC是否应该被截断。CRC保证信息传输的正确性。

\item \textbf{\texttt{ACK}命令简介：}
\texttt{ACK}命令确认时隙是否为单一时隙，长度为18位，\texttt{ACK}命令包含标签回复的16位长度的RN16字符串（详情请参阅C1G2标准79页）。在传统C1G2标准中，如果阅读器向标签发送ACK 命令，且标签接收到命令后对比ACK中的RN16与自身先前回复的RN16，如果两者一致，则证明该时隙为单一时隙，该标签为时隙内的唯一标签，标签回复阅读器EPC ID 或特定字符串表明自己被成功识别；否则，两者不一致，则证明该时隙为冲突时隙，冲突时隙内的标签不能被识别，标签返回先前的自由状态（处于Ready和Killed状态的标签除外）。

\begin{table}[t]
	\centering
    \bicaption[tab:Kill]{}{\texttt{Kill} 命令的结构}
    {Tab.}{Structure of \texttt{Write} commands}
	\begin{tabular}{ccc}
		\hline
		% after \\: \hline or \cline{col1-col2} \cline{col3-col4} ...
		字段 & 位数& 功能\\
		\hline
		Password& 16 &  对阅读器进行验证\\
		RFU& 3 & 指令功能扩展位 \\
		RN& 16&     标签回复RN16数据整合\\
		CRC& 16 &     CRC-16检错检验码\\
		\hline
	\end{tabular}
\end{table}

\item \textbf{\texttt{KILL}命令简介：}
\texttt{Kill}命令允许阅读器灭活一个标签。标签灭活的方式有两种：基于密保的标签灭活和基于身份验证的标签灭活。基于密保的标签灭活无需对阅读器进行身份验证，阅读器需要发送两次连续Kill命令来灭活标签。而基于身份验证的标签灭活只需要发送一次Kill命令。CRM发送Kill命令的目的是为了灭活已知标签，减少已知标签对未知标签识别的干扰。如表~\ref{tab:Kill}，Kill指令包括四个字段：Password，RFU，RN和CRC。Password指示阅读器是否需要合法；RFU为Kill命令功能扩展位；RN为标签返回RN16数据的整合；CRC为数据校验位。
\end{asparaenum}

CRM利用以上3个命令完成未知标签识别的目的。\texttt{Select}选择激活需要检测的已知标签群组，阅读器发送\texttt{Inventory}命令和\texttt{Query}命令开始对选定的标签盘点识别。\texttt{Query}命令中包含时间帧中时隙数量、哈希种子等参数。为了确认每个时隙的状态，阅读器发送包含标签返回的RN16字符串的\texttt{ACK}命令帮助标签识别当前时隙状态。单一时隙的标签能够被顺利识别，已知标签被\texttt{Kill}命令灭活，未知标签返回标签ID信息。冲突时隙通过区分位区分冲突标签，进一步提升未知标签识别概率和已知标签的灭活效率。

\section{CRM协议设计}\label{CRM_protocol}
\esection{The Design of Tag CRM}
\begin{figure}[t]
    \setlength{\abovecaptionskip}{0pt}
    \setlength{\belowcaptionskip}{0pt}
  \centering
  \includegraphics[width=0.8\textwidth]{CRM}
  \bicaption[CRM]{}{标准ALOHA协议与CRM协议的对比}{Fig.}{Comparison between standard ALOHA and CRM.}
\end{figure}

\begin{figure}[t]
    \setlength{\abovecaptionskip}{0pt}
    \setlength{\belowcaptionskip}{0pt}
  \centering
  \includegraphics[width=0.6\textwidth]{PCRM1}
  \bicaption[PCRM1]{}{CRM协议的执行流程}{Fig.}{Implementation process of CRM agreemen.}
\end{figure}

在标准Aloha协议中，冲突时隙以及空时隙被废弃，直接降低了时隙利用率，导致未知标签识别效率较低。为解决该问题，本章设计了冲突分解法（CRM），CRM不仅能有效灭活冲突时隙中已知标签，而且能识别冲突时隙中的未知标签，把冲突时隙变为可用时隙，大幅提高已知标签灭活及未知标签识别效率。

本章将详细介绍CRM协议的执行过程，并具体分析冲突分解法的执行优势，介绍区分码的设计以及区分码在未知标签识别中发挥的作用。


%我们设计了DTS通过选择性读取的方式实现个性化的标签采样。我们提出的DTS方法不需要额外的硬件开销，例如哈希函数和复杂信息理解。DTS主要由分配和采样两种操作组成。在标签注册入库时，我们通过分配操作将一个代表采样概率的二进制字符串写入标签。在进行标签监控室，我们通过采样操作对标签根据其写入的采样概率进行采样。接下来，我们将详细介绍这两个操作。


%\begin{asparaenum}
%\item \textbf{时隙索引预留：}
\subsection{V-RNx的设计与引入}
\esubsection{Slot-index reservation}
在冲突分解法中，本文引入了$V-RNx$的规则，与传统的$RN16$相比，$V-RNx$由$V_k$以及$RNx$组成，其中$V_k$被称为区分码，$RNx$被称为随机码。为尽可能减少对标准Aloha协议的改变，$V-RNx$与传统$RN16$都由16位数据构成，因此$k+x=16$。$RN16$是标签内部随机数生成器生成的16位伪二进制随机数，具有冲突检测功能，随机数个数为$2^{16}$，假如有两个标签选择同一个时隙，冲突被检测出来的概率为$1-16/(2^{16})^2$，数值接近于1。假如有$w$个标签选择同一个时隙，冲突被检测出来的概率为$1-16/(2^{16})^w$，数值无限接近于1。然而在已知的标签识别协议以及未知标签检测/识别协议中，在识别效率最高时，空时隙的概率为36.8\%，单一时隙在$f$个时隙中所占比例为36.8\%，有2个标签选择同一时隙的概率为18.4\%，3个标签选择同一时隙的概率为6.13\%，因此，在一个时隙中标签数量少于4个的概率为98.13\%。也就是说，在优化后的识别协议中，选择同一个时隙的标签数量很少，利用16位随机数来检测冲突会造成很大的资源浪费，过多的数据量发送也会导致识别效率下降。$V-RNx$把$RN16$分成两部分，长度分别为$k$和$x$，长度为$k$的部分为区分码且全部初始化为0，长度为$x$的部分为随机码，由标签内部随机数生成器生成长度为$x$的二进制随机数。假设$x$的数值为8，如果有2个标签选择同一时隙，则冲突能被检测出来的概率为$1-8/(2^8)^2$，其值接近于99.99\%，当有$w$个标签选择同一时隙响应时，冲突能被检测出来的概率为$1-8/(2^8)^w$，该值无限接近于1。剩余的8位区分码数据可以用作分解冲突标签。

$V-RNx$中长度为$k$的部分用于分解冲突标签。在冲突分解法执行过程中，假设标签已经接收到阅读器的\texttt{Query}命令以及参数$<f,r_1,r_2,\dots,r_\lambda,k>$，其中哈希种子$<r_1,r_2,\dots,r_\lambda>$统称为$r$，此时，标签除了选择自己所在时隙外，还要生成自己的区分码以及随机数。区分码初始化为$k$位0二进制字符串，标签利用接收的哈希种子$r_i(r\leq \lambda)$再次进行哈希运算，计算式如式（4）所示：

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{CRMAloha}
\begin{aligned}
c\!=\!\mathcal{H} (ID,r_i)\!\mod \!k,
\end{aligned}
\end{equation}
\end{small}
其中：$c$为标签标志位，也就是区分位，当运算完成后，区分码中第$c+1$位变为1，其余位仍然保持为0。这样，在冲突时隙中，每个冲突标签都有自己的标志位，当冲突标签标志位不同时，冲突标签就能得到区分。当区分位只有一个标签选择时，称之为单一区分位，没有标签选择时称之为空区分位，有多个标签选择时称之为冲突位。假设在$V-RNx$中$k$的值为8，当有2个标签选择同一时隙时，两个标签能够区分的概率为87.5\%，当有3个标签选择同一时隙响应时，至少一个标签能被区分的概率为98.4\%，也就是说，当有$w$个标签选择同一时隙时，任意一个冲突标签能被区分的概率为$\frac{w}{k}\times(1-\frac{1}{k})^{w-1}$，$w$个冲突标签能被分解出来的标签数量为$w\times(1-\frac{1}{k})^{w-1}$。

单轮的协议执行无法满足系统需求，因此，CRM需要执行多轮，且每一轮CRM的执行过程都包括3个部分：已知标签响应时隙以及区分位预测，未知标签识别和已知标签灭活。CRM协议的执行过程如图~\ref{CRM}所示。
%分配操作的主要目的是将采样概率写入标签的用户存储区。对每个标签，阅读器需要在它们的内部存储区写入一个二进制向量，用于表示该标签的采样概率，接下来的采样操作会用到该二进制码进行标签抽样。
%%
%默认情况下DTS使用二进制向量中字符`1' 的比例，表示标签的采样概率。例如，如果一个10位的二进制向量中字符`1'的数量为5，则对应的采样概率为1/2。
%%
%虽然有诸如IEEE 754等更高效的浮点数表示方法，但是我们很难使用\texttt{Select}命令对IEEE 754格式的浮点数进行解析。
%%
%为了将特定采用概率转换成一个$k$位的字符串，我们首先通过公式$n_1 = \lceil p\times k\rceil$ 计算应有的字符`1' 的数目，然后我们将$k$位字符串的前$n_1$位置为`1'，其余位置为`0'。
%%
%最后，我们将字符串进行一次洗牌操作，洗牌后的字符串同样包括$n_1$个`1'，但是`1'的位置进行了重新排列。
%%
%因为洗牌操作的存在，有着相同采样概率的两个标签可能会被写入两个不同的二进制向量，这保证了它们会在不同的轮次被采样。例如，当$k=10$， $p=0.3$时，标签1和标签2分别被写入二进制向量`1000001001'和`110000010'。
%%
%因此，当\texttt{Select}命令选择的位为1、7、10 时，标签1会被采样。当\texttt{Select}命令选择的位为1、2、9时标签2 会被采样。
%%
%分配操作在标签注册入库时进行，为了将二进制向量写入标签，阅读器需要发送三种类型的C1G2命令：既\texttt{Select}，\texttt{Query}和\texttt{Write}。\texttt{Select}命令用了选取目标标签，因为WRITE命令一次只能对一个标签进行操作。
%%
%具体的\texttt{Select}命令的字段的设置如表\ref{tab:sampling}所示，命令长度为117位。其中MemBank 字段设置为01指向EPC存储区，Pointer字段设置为0x20，指向EPC ID的抵制，Mask字段设置为96位的目标标签的ID。
%%
%因此只有被选择的目标标签会被激活，并向阅读器发送回复。接下来，阅读器会发送\texttt{Query}命令来识别目标标签，因此\texttt{Select}命令只选出一个目标标签，\texttt{Query} 命令的$Q$字段的值设置为0000，代表帧长为1。
%%
%在这个时隙中，阅读器和标签按照EPC 规范附录E\ucite{epcc1g2}中描述的交互过程进行通信。在识别标签后，阅读器会获得标签的$handle$。最后，阅读器会使用\texttt{Write}命令和$handle$来访问标签的USER存储区。
%%
%\texttt{Write}命令各字段的具体设置如表\ref{tab:write}所示，因为二进制向量需要被写入USER存储区，MemBank字段设置为11。我们假设所有标签的USER存储区的前端地址预留用于存放采样概率，因此WordPtr字段设置为0x00。
%%
%指向USER存储区前16字节的位置。因为每个\texttt{Write}命令只能写入16 个字节，因此如果需要写入的二进制向量的长度大于16位，那么我们需要发送多个\texttt{Write}命令，之后的\texttt{Write}命令的WordPtr字段依次设置为0x01、0x02、$\cdots$。
%%
%由于只在标签入库或者采样概率发送变化时进行，分配操作不需要频繁的执行，也不会带来过多的时间开销。
%%
%\begin{table}[t]
%	\centering
%    \bicaption[tab:successful]{}{分配操作中的\texttt{Select}命令}
%    {Tab.}{\texttt{Select} commands in sampling operation}\label{tab:sampling}
%	\begin{tabular}{cccc}
%		\hline
%		% after \\: \hline or \cline{col1-col2} \cline{col3-col4} ...
%		字段 & 位数& 数据 & 功能\\
%		\hline
%		Target& 3 & 100& 修改\textbf{SL}标记\\
%		Action& 3 & 000& 如果Mask 和标签上数据相符将\textbf{SL}置为活跃状态\\
%		MemBank& 2 & 01& 用户存储区\\
%		Pointer& 8 &  variable& 随机选取的采样概率向量中能够的某一位 \\
%		Length& 8& 00000001& Mask 的长度1-bit\\
%		Mask& 1 & 1& Mask设置为`1'\\
%		Truncate& 1& 0& 不使用数据截断功能\\
%		CRC& 16 & CRC-16&  数据校验码\\
%		\hline
%	\end{tabular}
%\end{table}


%\item \textbf{标签识别:}
\subsection{已知标签时隙选择和区分位预测}
\esubsection{Tag Identification}
在协议执行之前，$<f,r_1,r_2,\dots,r_\lambda,k>$参数已知，且已知标签ID保存在后台服务器，因此后台服务器可根据哈希函数$s_c\!=\!\mathcal{H} (ID,r_1)\!\mod \!f$以及式~\ref{CRMAloha}预测已知标签选择的响应时隙以及每个标签在时隙中的区分位，本章称之为期望映射。参数$r_1$既要参与时隙的选择计算也要参与区分位的选择计算，$<r_2,r_3\dots,r_\lambda>$只参与区分位的计算。因此，在时隙以及区分位预测阶段，每个已知标签都要选择1 个时隙，以及$\lambda$个区分位。在时隙选择时，时隙数量为$f$，在区分位选择时，区分码的长度为$k$。

\subsection{未知标签识别}
\begin{figure}[t]
    \setlength{\abovecaptionskip}{0pt}
    \setlength{\belowcaptionskip}{0pt}
  \centering
  \includegraphics[width=0.25\textwidth]{CRMAloha22}
  \bicaption[CRMAloha22]{}{区分码甄别未知标签}{Fig.}{Discriminant code identify unknown tags.}
\end{figure}
使用冲突分解法识别未知标签时，在单一时隙和空时隙上的处理与标准Aloha协议相同，然而，在冲突时隙的处理上与标准Aloha协议差别较大。期望映射中区分码表示为$Q$。在冲突分解法中，阅读器首先发布参数$<f,r_1,r_2,\dots,r_\lambda,k>$，在标签收到参数后，根据函数$s_c\!=\!\mathcal{H} (ID,r_1)\!\mod \!f$选择自己所在时隙，并依据函数$c\!=\!\mathcal{H} (ID,r_i)\!\mod \!k$生成自己的区分码，将实际映射中的区分码表示为$A$，如图~\ref{CRMAloha22}所示。多哈希种子的使用目的是尽可能把未知标签从冲突位中区分出来。

在分解冲突法中，时隙的状态包括空时隙、单一时隙、冲突时隙3种。

\begin{asparaenum}
\item 空时隙中没有任何标签回应阅读器的Query指令。

%传统的RN16(16位随机数)是一个二进制字符串，由随机数或伪随机数生成器（Random or pseudo-random Number Generator，RNG）随机生成。标准Aloha 协议如图\ref{Linkbetweenreaderandtag}{b}所示，当标签为非空时隙时，标签回复RN16答复阅读器问询，为检测该时隙状态，阅读器返回一个包含RN16 的\texttt{ACK}指令使阅读器辨别时隙状态，当接收到\texttt{ACK}指令后，标签对比先前自身发送的RN16与\texttt{ACK}指令中包含的RN16，如果两者一致，则该时隙为单一时隙，否则为冲突时隙。传统RN16能够区分单一时隙和冲突时隙，但它不能提供任何关于时隙中标签优先级的信息。在PTI中，我们将传统RN16修改为P-RN16，P-RN16将PID引入传统的RN16。因此，P-RN16由PID和RNx两部分组成。PID的长度为$w$，RNx的长度为$(16-w)$。因此，如果我们从P-RN16中从左到右提取第一个$1$的索引，就可以识别出优先级最高的PID。由于RN16长度限制，利用改进传统RN16的方式能够同时进行标签识别的优先级群组数量最多为16个，如需同时识别更多优先级群组，可以增加P-RN16的长度允许更多优先级设置。在PTI中，区别于标准Aloha协议的\texttt{ACK} 指令，阅读器提取RN16 中的PID并把从左到右的第一个$1$保留，其它位全部设置为$0$，因此\texttt{ACK}中包含最高优先级标签群组的PID和P-RN16的RNx两部分。我们可以确定，当标签传输的RNx与ACK中包含的RNx不同时，就发生了冲突。

\item 单一时隙有且仅有一个标签回复阅读命令，且在V-RNx验证通过后，标签可以向阅读器发送特定数据，如果单一时隙是已知标签，则该标签会被灭活，不会参与下一轮的未知标签识别过程。如果该时隙的标签为未知标签，则向阅读器发送标签ID。

%在PTI中，在第一阶段的时隙索引预留之后，阅读器发出\emph{Query}命令来探测每个忙时隙。在探测期间，四种槽类型将执行不同的操作。我们在图\ref{Linkbetweenreaderandtag}{c}中展示了阅读器和标签之间的通信链路，并对协议执行过程中出现的三个时隙状态的不同通信模式分别解释说明。

%\begin{asparaenum}[(i)]
%\item \textbf{空时隙：}在时隙索引预留阶段，空时隙被标记，在PTI执行时，空时隙将被直接跳过，减少空时隙带来的时间消耗。
%\item \textbf{可用冲突时隙：}可用冲突时隙是能成功识别最高优先级标签的冲突时隙，即是冲突时隙成功转变为伪单一时隙。
%如图\ref{Linkbetweenreaderandtag}{a}所示，时隙3是一个可用的冲突时隙，其中只有一个属于最高优先级群组的标签会响应。PTI对可用冲突时隙的操作如图\ref{Linkbetweenreaderandtag}{c}中对时隙3中标签的验证读取。在PTI 中，从冲突时隙转变为伪单一时隙需要两次时隙状态确认。在第一次时隙状态确认时，阅读器提取最高优先级标签群组的PID，构造ACK1，ACK1包含提取的PID 和阅读器接收到的组合RNx。如果标签接收到的PID与自身相同，但RNx发送错误，则标签将重新将P-RN16发送给阅读器。在第二次时隙状态确认中，重新验证ACK2 中包含的PID和RNx，如果它们都正确，标签将向阅读器发送EPC ID信息。
%\item \textbf{非可用冲突时隙：}非可用冲突时隙即有多于一个的最高优先级群组标签选择该时隙。非可用冲突时隙不能成功转化为伪单一时隙，不能获取冲突时隙中任何优先级的标签ID。如图\ref{Linkbetweenreaderandtag}{a}所示，时隙4是一个非可用冲突时隙，其中2个属于当前最高优先级群组的标签会响应阅读器问询。非可用冲突时隙的操作也需要两次时隙状态确认，在第一次确认中，此时隙的操作与可用冲突时隙相同。在第二个确认中，最高优先级的两个标签重新发送用于验证的P-RN16，阅读器在此返回包含P-RN16的ACK2命令，标签收到ACK2命令后进行第二次对比，在第二次对比中，ACK2中的RNx与两个标签二次发送的RNx均不相同，则标签仍识别为冲突时隙不发送ID信息。
\item 冲突时隙有多个标签同时选择同一时隙。
%\end{asparaenum}

\end{asparaenum}

在空时隙与单一时隙的执行效率上，分解冲突法与标准Aloha协议没有任何区别。然而标准Aloha协议无法解决多标签信号重叠问题。因此为提高Aloha协议识别未知标签的效率，冲突时隙会被直接跳过。但在冲突分解法中，由于区分码的引入，分解冲突法能够把绝大部分冲突时隙转变为可用时隙，从而增大时隙利用率，提升已知标签灭活、未知标签的识别效率。冲突时隙的分解过程如图~\ref{CRM}(b)所示，假如$k$值为4，在期望映射中，标签区分码为$1000_2$，而在实际映射中标签区分码为$1001_2$，也就是说$Q$为$1000_2$，A为$1001_2$。该冲突时隙里既有已知标签，也有未知标签。冲突分解法执行时首先检测期望映射中该时隙区分码的$(A-Q)$中各位是否全为0，如果全为0，则计算$<r_2,r_3\dots,r_\lambda>$中$(A-Q)$中各位的情况，如图~\ref{CRM}所示，此时标签只回复阅读器\texttt{DACK}命令，其中\texttt{DACK}的长度为$k$，$RNx2$的总长度为$k\times(\lambda-1)$。如果$A\sim Q$ 位不全为0，则表明未知标签被区分出来，只需检测对应非零位的未知标签是否为单一标签。如图~\ref{CRM}(b)中的(2)$\sim$(3)所示，如果该标签是单一标签，则该未知标签ID可以被顺利收集，否则，该区分位不作处理，继续检测下一非零区分位。

在冲突分解法中，被识别的未知标签不参与下一轮协议执行，以下4种情况的未知标签能被识别：

\begin{asparaenum}
\item 当期望映射中的空时隙转变为单一时隙时，说明有且仅有一个未知标签响应阅读器询问命令，未知标签可以在reply中回复标签ID；
\item 当期望映射中的空时隙转变为冲突时隙时，说明有多个未知标签选择同一时隙回应阅读器询问命令，当冲突分解法分解冲突时，如果有单一区分位，即有且仅有一个标签选择该区分位，则该标签能够被识别，否则对应的未知标签不能被识别，不能被识别的未知标签将参与下一轮未知标签识别；
\item 当期望映射中的单一时隙在实际映射中变为冲突时隙时，可以确定该时隙有未知标签，如果$\lambda$个哈希种子生成的区分码$(A-Q)$不全为0，且存在单一区分位，则对应的未知标签能被识别；
\item 当期望映射中的冲突时隙在实际映射中仍然为冲突时隙，但两个冲突时隙区分码不同时，则未知标签分布在$(A-Q)$中，如果在$(A-Q)$中有单一区分位，则该区分位所对应的标签为能够被识别的未知标签，否则为不能被识别的未知标签。
\end{asparaenum}

\subsection{已知标签灭活}

已知标签的存在严重干扰未知标签的识别，当已知标签与未知标签选择同一时隙时，能够造成未知标签的假阴性，而区分码可以降低假阴性的概率。因此在实际映射的冲突时隙中，如果$\lambda$个哈希种子$(A-Q)$中各位全部为0，则可断定此时隙中的标签全为已知标签，阅读器发送\texttt{kill}命令直接灭活。

在冲突分解法中，被灭活的已知标签不参与下一轮未知标签检测，减小下一轮协议执行时已知标签对未知标签识别的干扰，有两种情况已知标签能被灭活，如图~\ref{CRM}中已知标签灭活部分：
\begin{asparaenum}
\item 期望映射中的单一时隙在实际映射中仍为单一时隙，说明有且仅有一个已知标签选择该时隙，阅读器可以向标签发送\texttt{kill}指令，直接灭活该标签；
\item 期望映射中为冲突时隙，在实际映射中仍为冲突时隙，且当$\lambda$个哈希种子产生的区分码$(A-Q)$中各位全为0时，则表明该时隙中的标签全为已知标签，则直接执行\texttt{kill}命令。
\end{asparaenum}







%采样操作为了以预先写入的采样概率对标签进行采样。其基本思想是发送\texttt{Select}命令选取特定的标签，从而模拟标签采样的过程。
%
%阅读器发送的\texttt{Select}命令对标签USER存储区中存储的概率二进制向量进行匹配检验。具体来说，阅读器会检测二进制向量中随机选取的某一位，如果该位为`1'，则该标签会被采样。
%
%否则，该标签会保持沉默，不向阅读器回复消息。因此，机制保证了二进制字符串中`1'更多的标签能以更高的概率被采样。为了实现上述这种机制，\texttt{Select}命令的各字段的具体设置如表\ref{tab:sampling}所示。
%
%首先，因为采样操作要对USER存储区中存储的二进制向量进行匹配检验，因此MemBank字段设置为11，指向用户存储区。其次，Pointer字段设置为阅读器生成的随机数，令$k$ 为表示采样概率的二进制向量的长度，
%
%则Pointer字段随机数的取值范围为$0\sim k-1$。最后，Mask字段设置为1 位的字符`1'。由于Mask位数较短，采样操作中使用的\texttt{Select}命令的长度仅为42位，远小于分配阶段中使用的\texttt{Select}命令的长度。

%\end{asparaenum}


%从以上对三个时隙的操作我们可以得出结论，PTI中的单一时隙可以像标准Aloha协议中单一时隙一样只需一次时隙状态确认就能成功地收集标签ID信息，但不像标准Aloha协议直接废弃冲突时隙的方式，PTI尝试将部分冲突时隙转化为伪单一时隙，伪单一时隙不能随意收集冲突时隙内冲突标签ID信息，只能筛选最高优先级标签回复标签ID信息。因此，PTI对冲突时隙的利用不仅可以提高时隙的利用率，而且可以使高优先级群组比低优先级组享有更高的时隙占有率。如图\ref{Linkbetweenreaderandtag}所示，RFID系统中有两个优先级群组的八个标签，PID为$10$的优先级高于$01$。在标准Aloha协议和PTI中标签1 和标签8映射入单一时隙可以被成功识别，其余的标签在标准Aloha协议中由于标签冲突而无法被识别。但是，在PTI中可以成功收集到标签2的ID，因为冲突时隙3可以转化为伪单一时隙，标签2的优先级高于标签6和标签7。




%接下来，我们讨论了DTS协议实现过程中的一线具体问题，包括Pointer字段的生成，二进制向量长度的选择以及二进制向量的生成。我们分析了DTS协议在不同实现方式之下的表现，并以此为依据对DTS的参数进行优化和选择。
%%
%\begin{figure}
%	\centering
%	\begin{minipage}[t]{0.49\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{/dts/simk}
%		\bicaption[fig:simk]{}{包含未采样位的轮次数}{Fig.}{\# of missing rounds}
%	\end{minipage}
%	\begin{minipage}[t]{0.49\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{/dts/accvsk}
%        \bicaption[fig:varyk]{}{采样概率的误差}{Fig.}{The error of sampling probability}
%	\end{minipage}
%\end{figure}
%%
%
%\textbf{Pointer字段生成：随机和乱序}
%在每次采样操作中，服务器首先需要生成一个随机的整数，用于设置\texttt{Select}命令中的Pointer字段的取值。
%%
%一个最直观的方法是在每次发送\texttt{Select}命令之前，使用均匀随机整数生成器生成器得到一个取值范围在$1\sim k$之间的整数。
%%
%该方法最主要的一个缺陷就是，一些特定的位在很多轮后可能仍然不能被选出。对一个特定的取值范围在$1\sim k$之间的整数，$i$轮之后，仍然没能被生成的概率可以表示为
%\begin{equation}\label{missing_probability_random}
%p_{m} = \left(\frac{k-1}{k}\right)^{i}
%\end{equation}
%为了准确的表示丢失采样的概率，我们模拟了不同$k$值下的随机采样，结果如图\ref{simk}所示。
%%
%对于每个$k$，我们进行了1000次独立重复实验，在每次实验中，我们进行了100次采样操作，然后检查是否有$1\sim k$中的整数是否全部被采样。
%%
%即使当$k$值较小时，采样丢失仍然是一个十分普遍的现象。例如，当$k=20$ 时，100轮过后，某些位发生采样丢失的概率大约为10\%。
%%
%而采样丢失概率随着$k$的增大而增大，当$k=45$时，采样丢失概率接近100\%。
%%
%假设某个标签采样概率很小，其表示概率的二进制向量只有一位为`1'，而且该位恰巧一直没有被随机数生成器选取，则该标签在很长一段时间不能被抽中，造成很长的抽样间隔。
%
%
%为了避免有着较小的抽样概率标签有着过长的抽样间隔，我们可以采用一种基于洗牌策略的抽样方法。在乱序策略中，我们首先生成一个数组，其中包含$1\sim k$中所有的$k$个整数，然后我们使用乱序算法对数组中的元素进行重新排列，并依次使用其中的元素作为SELECT 命令的Pointer 字段的取值。一旦列表中的所有元素被使用，我们会重新使用乱序算法对数组中的元素进行重新排列，并重新便利数组中的元素。当采用乱序策略时，$i$轮过后丢失采样概率可以表示为：
%\begin{equation}\label{missing_probability_shuffle}
%p'_{m} = \left(\frac{k-i}{k}\right)
%\end{equation}
%根据公式\ref{missing_probability_shuffle}，我们可以确定，二进制向量中的任意一位在$k$次采样中必定会被采样至少一次。并且，两次采样之间的最大间隔次数是$2k-2$。最坏情况下，当一个整数在前一轮抽样中的第一次采样中被选择，而在后一轮抽样中的最后一次采样中被选择。当$k<51$ 时，字符串所有的位在100轮次采样中都将被采样至少一次，与随机采样相比，其性能显著提升。
%%
%\begin{figure}
%	\centering
%	\begin{minipage}[t]{0.49\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{/dts/timevsk}
%		\bicaption[fig:varym]{}{分配操作的时间开销\emph{vs.}$k$}{Fig.}{The assignment cost}
%	\end{minipage}
%	\begin{minipage}[t]{0.49\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{/dts/probarray}
%        \bicaption[fig:probarray]{}{采样概率示意图}{Fig.}{The example of probability array}
%	\end{minipage}
%\end{figure}
%%
%
%\textbf{二进制向量长度：精度和空间开销}
%二进制长度将会影响到采样的精度，使用较长的二进制向量可以保证较高的采样精度，但是同样也意味着更大的空间开销，因此我们需要选择一个合适的二进制长度$k$，在这两者之间进行权衡。在精度方面来说，实际上的采样概率可以表示为$\lceil p \times k \rceil/k$， 与理论上的采样概率$p$ 之间的最大误差位$1/2k$。因此，采样精度和二进制向量的长度$k$成正比。
%%
%然而，较大的$k$ 同样意味着，二进制向量需要占据更多的存储区空间。此外，考虑到WRITE命令一次只能写入16 位的数据，写入较长的二进制向量同样需要更多的时间。在实际应用中，我们需要根据具体的需求选择合适的$k$。
%
%$k$的最大值由User存储区的大小所决定。例如，本文中采用的商用Monza 4QT标签\ucite{monza4}得User存储区的大小为512 字节。因此，理论上来说，我们可以用4096位的二进制向量来表示采样概率。这个大小的二进制向量能够支持十分精确的采样概率，误差度不会超过$1.22\times10^{-4}$，能够满足绝大多数应用的需求。为了平衡内存空间开销和精度的需求，我们限定$k$的长度不能超过500位，只占用User 存储区的$1/8$，采样概率的精度为$10^{-3}$。 我们做出这种限定主要出于两点考虑。首先，我们不能使用过多的空间用于单一的采样操作。第二，继续增加$k$的取值不能带来更多的精确度提升。如图\ref{}所示，当$k=10$ 时，提升$k$能显著提升采样概率。当$k=1500$时，继续提升$k$对精度的影响相对较小。
%
%因为WRITE命令一次只能写入2字节的数据，我们可能，我们可能需要将表示采样概率的二进制向量切分成若干块，并使用多个\texttt{Write}命令，将每一块写入标签的USER存储区。
%%
%因此分配操作的执行时间和二进制向量的长度$k$成正比。假设标签和阅读器之间的传输速率时40~Kb/s，传输每位的的开销是25us.因为每个\texttt{Write}命令的长度是59位，因此，传输每个\texttt{Write}命令的开销大约为1.45~ms。
%%
%总共的时间开销如图\ref{fig:probarray}所示。为了充分利用WRITE命令，我们通常将$k$设置为16 的整数倍。这样，写入内存的每一位都有实际意义。
%
%
%\textbf{减少二进制向量的空间开销}
%在DTS所使用的二进制向量的设计中，我们假定每一位有着相同的权重。但是这种设置之下，为了表示高精度的抽样概率需要过大的内存开销。为了减少表示高精度抽样概率所需的二进制向量的长度，我们可以为二进制向量中的每一位分配不同的权重。权重的分布服从负指数分布，第$i$位有的权重为$2^{-i}$。所有权重之和为1。令$p_m$ 表示二进制向量所表示抽样概率的最大误差，则使用负指数分布时，所需要的二进制向量长度$k$可以表示为
%\begin{equation}\label{space_efficient_k}
%k = \left\lceil log_2 (\frac{1}{p_m})\right\rceil.
%\end{equation}
%原有的均匀权重方法，达到相同精度所需要的二进制向量长度$k=\lceil 1/p_m\rceil$，与均匀权重方法相比，负指数权重方法显著减少了空间开销。需要注意的是，在抽样操作中，不同位被选取的概率同样应该服从同样的负指数分布。
%
%
%
%\section{DTS方法的实际应用}\label{dts_application}
%\esection{Practical DTS Applications}
%在本节中，我们讨论了构建在DTS方法上的概率性协议。

\section{参数优化}\label{Optimize_parameters}
\esection{Multi-category Tag Cardinality Estimation}
\subsection{优化参数$k$的优化}
$V-RNx$的长度与标准$RN16$保持一致，在协议执行过程中不会因为$V-RNx$的长度对未知标签识别协议的执行效率产生影响。但$V-RNx$由区分码和随机码两部分构成，区分码的长度为$k$，随机码的长度为$16-k$，区分码的长度决定了冲突标签能被区分的概率大小，而随机码的长度决定了阅读器是否能够准确识别冲突时隙，如果把冲突时隙辨认为单一时隙，阅读器就会收到错误的未知标签ID，或者把未知标签误认为已知标签灭活。在标准Aloha协议中，如果有$w(w>1)$个标签选择同一个时隙，冲突被检测出来的概率为$1-\frac{16}{(2^{16})^w}$，即同一时隙标签越多，冲突检测越容易。因此，至少要保证2个标签的冲突时隙能够被准确识别。在$V-RNx$中，此种冲突时隙能被准确识别的概率为$1-\frac{16-k}{(2^{16-k})^2}$，2个标签能被区分的概率为$\frac{k-1}{k}$。 当$k=8$时，两个标签的时隙能被准确识别为冲突的概率为99.99\%，两个标签能被区分的概率为87.5\%，满足冲突检测以及冲突标签区分的需要，故在优化$f$时，$k$值设为8。

\subsection{优化哈希种子数量$\lambda$以及帧长$f$}

帧长$f$过大将产生过多的空时隙，影响未知标签识别的效率，然而当$f$值过小时，会产生大量的冲突时隙。在冲突时隙中，当未知标签与已知标签产生相同的区分码，则未知标签会被认为是已知标签被灭活，产生假阴性的问题。为提高未知标签的识别效率及降低产生假阴性的概率，选择合适的$f$至关重要。选择合适的$f$要保证冲突时隙足够多，且冲突时隙中标签数量足够少。

假设一个冲突时隙中有$z$个已知标签，$y$个未知标签，则当$y$值为1时，产生假阴性的概率最大；当$y$值变大时，假阴性反而变小。因此，当$y$值为1时，假阴性的概率如式~\ref{p_f}所示：

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_f}
\begin{aligned}
p_f=1-\frac{k\times(k-1)^z}{k^{z+1}},
\end{aligned}
\end{equation}
\end{small}

假阴性产生的概率随$z$值增大而递增，当$z$为3时，假阴性的概率为33\%；当$z$为8时，假阴性的概率为66\%。

如果设$z$的值为3，也就是说，在绝大部分的单个实际时隙中，已知标签的数量小于等于3。然而，此时单个时隙的假阴性概率仍然无法满足系统需求，多次区分码的哈希运算可以增大已知标签的灭活及未知标签识别概率。冲突时隙中的未知标签被识别的概率如式~\ref{p_c}所示：

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_c}
\begin{aligned}
p_{\lambda}=1-{p^{\lambda}}_f \rightarrow 1,
\end{aligned}
\end{equation}
\end{small}
其中：当$\lambda$值为3时，$z$值为3；当$y$值为1时，假阴性的概率为3.6\%。则在一次实际的冲突分解法未知标签识别协议执行中，有$z$个已知标签，1个未知标签选择同一时隙的概率表达式如式~\ref{P_{x1}}所示：
\vspace{0in}
\begin{small}
\begin{equation}\label{P_{x1}}
\begin{aligned}
P_{x1}=\tbinom{n}{z}\times \left(\frac{1}{f}\right)^z\times \left(1-\frac{1}{f}\right)^{n-z}\times\frac{u}{f}\times \left(1-\frac{1}{f}\right)^{u-1}.
\end{aligned}
\end{equation}
\end{small}

当假阴性概率为0时，未知标签被识别的数量最多，则能被识别的未知标签数量最大值如式~\ref{M_u}所示：

\begin{small}
\begin{equation}\label{M_u}
\begin{aligned}
M_u=f\times p_{01}+f\times y\sum_{z=1,y=1}^{max}p_{zy},
\end{aligned}
\end{equation}
\end{small}
其中$max$为实际映射中$z$的最大值，设为3；$k$值为8，$p_{zy}$为时隙中有$z$个已知标签，$y$个未知标签发生的概率，当$y$值为1时，假阴性发生的概率计算式如式（9）所示：

\begin{small}
\begin{equation}\label{p_{f1}}
\begin{aligned}
p_{f1}=\sum_{z=1}^{max}p_{z1}\times p^{\lambda}_f\leq0.001,
\end{aligned}
\end{equation}
\end{small}
通过枚举的方法，得出最优$f_{op}=\frac{N}{2}$，$z\leq3$所占时隙的比例为88.76\%，满足协议的执行条件。

\subsection{ 执行时间$T$的优化}
为保证冲突分解法未知标签识别的可靠度，协议需要执行多轮。在保证未知标签识别效率的前提下，优化的参数$f_{op}$可以有效降低假阴性的比例。在每一轮协议执行中，预测时隙包含空时隙、单一时隙、以及冲突时隙，它们的概率计算式分别如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{en}}
\begin{aligned}
p_{en}=(1-\frac{1}{f_{op}})^n,
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.5in}
\begin{small}
\begin{equation}\label{p_{1n}}
\begin{aligned}
p_{1n}=\tbinom{n}{1}\times \frac{1}{f_{op}}\times(1-\frac{1}{f_{op}})^{n-1},
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.5in}
\begin{small}
\begin{equation}\label{p_{cn}}
\begin{aligned}
p_{cn}=1-p_{en}-p_{1n},
\end{aligned}
\end{equation}
\end{small}

在未知标签选择时隙时，同样会产生空时隙、单一时隙以及冲突时隙3种时隙状态，它们出现的概率分别如下：
\vspace{0in}
\begin{small}
\begin{equation}\label{p_{eu}}
\begin{aligned}
p_{eu}=(1-\frac{1}{f_{op}})^u,
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.5in}
\begin{small}
\begin{equation}\label{p_{1u}}
\begin{aligned}
p_{1u}=\tbinom{u}{1}\times \frac{1}{f_{op}}\times(1-\frac{1}{f_{op}})^{u-1},
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.5in}
\begin{small}
\begin{equation}\label{p_{cu}}
\begin{aligned}
p_{cu}=1-p_{eu}-p_{1u}.
\end{aligned}
\end{equation}
\end{small}

在实际时隙中，空时隙的概率如下：

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{00}}
\begin{aligned}
p_{00}=p_{en}\times p_{eu}=(1-\frac{1}{f_{op}})^N.
\end{aligned}
\end{equation}
\end{small}

某一时隙预测为单一时隙，而在实际映射中该时隙仍是单一时隙，说明该时隙所对应的标签为已知标签，此类时隙的概率计算式如式~\ref{p_{10}}所示：

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{10}}
\begin{aligned}
p_{10}=p_{1n}\times p_{eu}.
\end{aligned}
\end{equation}
\end{small}

当预测时隙为冲突时隙时，经过冲突分解法分解，$(A-Q)$中各位全部为0，则可判定在该时隙内无未知标签，标签可以被灭活，该类时隙所占比例的计算式如下：

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{c0}}
\begin{aligned}
p_{c0}=p_{cn}\times p_{eu},
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{2n}}
\begin{aligned}
p_{2n}=\tbinom{n}{2}\times(\frac{1}{f_{op}})^2\times(1-\frac{1}{f_{op}})^{n-2},
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{3n}}
\begin{aligned}
p_{3n}=\tbinom{n}{3}\times(\frac{1}{f_{op}})^3\times(1-\frac{1}{f_{op}})^{n-3}.
\end{aligned}
\end{equation}
\end{small}

当$z$值设为3时，执行一次冲突分解法，能够灭活的已知标签数量如下：

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{S}
\begin{aligned}
S_{Slience}=f_{op}\times(p_{1n}+2\times p_{2n}+3\times p_{3n})\times p_{eu}.
\end{aligned}
\end{equation}
\end{small}

灭活这些已知标签所用时间如下：

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{T_1}
\begin{aligned}
T_1=f_{op}\times\left[p_{1n}\times p_{eu}\times t_{sk}+(p_{2n}+p_{3n})\times p_{eu}\times t_{dk}\right].
\end{aligned}
\end{equation}
\end{small}

空时隙检测所用的时间如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{T_2}
\begin{aligned}
T_2=f_{op}\times p_{00}\times t_{se}.
\end{aligned}
\end{equation}
\end{small}

如果某一时隙在预测时隙中是单一时隙，而在实际时隙中变为冲突时隙，则可断定有未知标签选择该时隙，此类时隙的概率$(0<y\leq2)$计算式如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{11}}
\begin{aligned}
p_{11}=p_{1n}\times p_{1u},
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{12}}
\begin{aligned}
p_{12}=p_{1n}\times p_{2u}.
\end{aligned}
\end{equation}
\end{small}

能被识别的未知标签数量如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{D_1}
\begin{aligned}
D_1=f_{op}\times p_{11}+2\times p_{12},
\end{aligned}
\end{equation}
\end{small}

所需要的执行时间如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{T_3}
\begin{aligned}
T_3=f_{op}\times \left(p_{11}+p_{12}\right)\times (t_{ds}+t_{dc}),
\end{aligned}
\end{equation}
\end{small}

如果空时隙转变为非空时隙，则可说明该时隙所对应的标签全为未知标签，则该时隙的概率计算式如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{01}}
\begin{aligned}
p_{01}=p_{0n}\times p_{1u}
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{02}}
\begin{aligned}
p_{02}=p_{0n}\times p_{2u}
\end{aligned}
\end{equation}
\end{small}

能被识别的未知标签数量如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{D_2}
\begin{aligned}
D_2=f_{op}\times p_{01}+2\times p_{02},
\end{aligned}
\end{equation}
\end{small}

所需执行时间如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{T_4}
\begin{aligned}
T_4=f_{op}\times p_{01}\times t_{sl}+f_{op}\times p_{02}\times (t_{dc}+t_{ds})
\end{aligned}
\end{equation}
\end{small}

从冲突时隙中分解出未知标签，则相应的时隙所占比例分别如下：

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{21}}
\begin{aligned}
p_{21}=p_{2n}\times p_{1u}
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{22}}
\begin{aligned}
p_{22}=p_{2n}\times p_{2u}
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{31}}
\begin{aligned}
p_{31}=p_{3n}\times p_{1u}
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{p_{32}}
\begin{aligned}
p_{32}=p_{3n}\times p_{2u}
\end{aligned}
\end{equation}
\end{small}

则被识别的未知标签的数量如式~\ref{D_3}所示：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{D_3}
\begin{aligned}
D_3=f_{op}\times \left[p_{21}+p_{31}+2\times (p_{22}+p_{32})\right]
\end{aligned}
\end{equation}
\end{small}

分解此部分时隙所需时间如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{T_5}
\begin{aligned}
T_5=f_{op}\times (p_{21}+p_{22}+p_{31}+p_{32}) \times (t_{dc}+t_{ds})
\end{aligned}
\end{equation}
\end{small}

则冲突分解法执行协议中，未知标签被识别的总数如式~\ref{D}所示：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{D}
\begin{aligned}
D=D_1+D_2+D_3
\end{aligned}
\end{equation}
\end{small}

冲突分解法执行一轮的时间如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{T_{all}}
\begin{aligned}
T_{all}=T_1T_2+T_3+T_4+T_5+T_0
\end{aligned}
\end{equation}
\end{small}
$T_0$为上述未包含的时隙执行所需要的时间，此类时隙包括$(z>3,y>2)$的时隙，以及其他冲突分解失败的时隙，由于此部分时隙所占比重较小，在以上表述中未提及，但在实际仿真实验时，总的执行时间包括此类时隙执行所需时间。因此，灭活一个已知标签及识别一个未知标签所用时间分别如下：
\vspace{-0.1in}
\begin{small}
\begin{equation}\label{O_{OneS}}
\begin{aligned}
O_{OneS}=\frac{T_{all}}{S_{Slience}}
\end{aligned}
\end{equation}
\end{small}

\vspace{-0.1in}
\begin{small}
\begin{equation}\label{O_{OneD}}
\begin{aligned}
O_{OneD}=\frac{T_{all}}{D}
\end{aligned}
\end{equation}
\end{small}

\subsection{未知标签数量的估计}
未知标签的数量未知，已知最优帧长$f_{op}=\frac{N}{2}$，$N=n+u$，因此最优的$f$值无法直接获取。通过标签数量估计的方法可以获取系统中标签数量（包括已知标签和未知标签）。在RFID的研究领域中，对标签数量估计的方法有很多，例如SEM\ucite{liu2016multi}、REB\ucite{liu2016rfid}、ART\ucite{shahzad2014fast}、ZOE\ucite{zheng2013zoe}等。SEM 利用类别码可以同时实现多个类别标签的数量估计，SEM可以从多类别标签的融合信号中解码出单个类别标签的映射情况，同时利用时隙中空时隙的比例估算各个类别标签数量。REB利用阻塞标签保护用户隐私，同时实现目标标签数量估计，REB利用阻塞标签预测时隙状态，再通过计算空时隙转变为单一时隙以及冲突时隙的比例计算目标标签的数量。ART利用采样的方法使部分标签参与数量估计，通过计算时隙中连续单一时隙的段数以及单一时隙的数量，利用每段单一时隙的数量估测标签数量，采样的方法有效降低了帧长，提高了估计效率。ZOE同样利用采样的方法让小部分标签参与当前数量估计，但ZOE只利用一个时隙来完成数量估计任务，利用该时隙变成空时隙以及忙时隙的比例，从而估计标签数量。冲突分解法直接采用SEM中空时隙的比例估测标签数量。由于已知标签数量已知，初始$f_{op}=\frac{n}{2}$。





%多类别数量估计的一个直观的解决方案就是使用标签识别协议去收集所有标签的ID。在这之后，我们很容易根据ID 确定标签所属的类别，并确定每个类别中标签的数量。
%%
%由于需要传输大量的标签ID，该方案在大规模RFID系统中执行时间过长，并造成过大的查询延迟。
%%
%因此，本文利用DTS方法设计并实现了一种高时效性的多类别标签数量估计(Multi-category Tag Cardinality Estimation)方法。
%%
%在MTCE方法中，我们需要提前使用DTS 中的分配操作为每个标签分配一个采样概率。其中，属于同一类别的标签$C_i$，因为价值和重要程度类似，会被分配同样的采样概率$p_i$。
%%
%在随后的数量估计过程中，阅读器只需要执行DTS中的标签抽样算法，对样本标签的ID进行识别和收集，并统计样本标签中属于每个类别$C_i$的标签数量，记为$X_i$。
%%
%由于$X_i$的取值服从以$n_i$和$p_i$ 为参数的二项分布，类别$C_i$中恰好有$X_i$的标签被采样的概率可以表示为：
%%
%\begin{equation}
%Pr(X_i) = \binom{n_i}{X_i} \times p_i^{X_i} \times(1-p_i)^{n_i - X_i}
%\end{equation}
%%
%因此，$X_i$的期望和方差可以分别表示为$\mu = n_i p_i$和$\delta^2 = n_i p_i  (1-p_i)$。
%%
%根据期望的表达式，我们可以得到$n_i$的估计值如下：
%\begin{equation}
%\hat{n}_i = X_i / p_i
%\end{equation}
%估计器$\hat{n}_i$的置信区间可以表示为：
%\begin{equation}\label{c4_eq_confidence}
%Pr\left(\hat{n}_i - \frac{z_{\alpha}\delta}{p_i} \leq n_i \leq \hat{n}_i + \frac{z_{\alpha}\delta}{p_i} \right )  = \alpha
%\end{equation}
%其中$z_{\alpha}$是$\alpha$对应的分位数， 通过查表得到。例如，当$\alpha=95\%$时， $z_{\alpha}$的取值为$1.96$。
%%
%为了符合估计精度的要求，$\hat{n}_i$的方差需要满足以下约束条件
%%
%\begin{equation}\label{c4_eq_constraint}
%\delta \leq \frac{\beta n_i p_i}{z_{\alpha}}
%\end{equation}
%通过联合式\ref{c4_eq_confidence} 和式\ref{c4_eq_constraint}，我们可以得到满足估计精度要求的抽样概率的取值$p_i$如下：
%\begin{equation}\label{c4_eq_prob}
%p_i =  \frac{Z_{\alpha}^2}{\beta^2 n_i + Z_{\alpha}^2}
%\end{equation}
%也就是说，只要设定的抽样概率大于$p_i$，就能保证估计器$\hat{n}_i$能以$\alpha$的置信度符合估计精度$\beta$的要求。
%%
%根据式\ref{c4_eq_prob}，我们发现$p_i$的取值依赖于类别中的标签数量。为了实现高效率的多类别数量估计，我们显然需要根据各类别中的标签数量的多少，为不同类别的标签分配不同的采样概率。
%%
%如果一个类别$C_i$中的标签数目较多，则可以为其分配一个较小的采样概率$p_i$，从而减少收集样本标签的时间消耗。
%%
%反之，如果$C_i$中的标签数目较少，则可以为其分配一个较大的采样概率$p_i$，从而保证估计的精度。
%%
%需要注意的是，在执行数量估计之前各类别中所包含的标签数量$n_i$通常是未知的。接下来，我们会解释如何在$n_i$未知的情况下对采用概率$p_i$进行设定。
%%
%事实上，数量估计协议MTCE通常包含多轮用于监控库存信息。
%%
%当MTCE的第一次执行时，我们只能根据经验设定$p_i$的值。但是，在之后的执行轮次中，我们可以将上一轮的估计结果$\hat{n}_i$来计算最合适的$p_i$。
%%
%由于MTCE需要被频繁的执行来获取实时的库存，该估计值和真实值差距一般不会太大，可以满足采样概率优化的要求。
\section{冲突分解法的其他应用}\label{Other applications for CRM}
\esection{Other applications}
在传统基于时隙的Aloha协议中，冲突时隙不可避免，冲突分解法不仅可以用于解决未知标签识别问题，还可以提高多种基于时隙的Aloha协议的应用效率，包括标签识别、丢失标签检测/识别效率等。

\subsection{标签识别}
\esubsection{Tag identification}
传统的标签识别方法只是利用时间帧中单一时隙搜集标签ID，冲突时隙被直接废弃。然而，冲突分解法可以使冲突的标签再次选择自己的区分位，通过区分位辨别冲突标签，有效降低冲突标签的数量，提高时隙利用率，加快标签识别效率。

\subsection{丢失标签检测与识别}
\esubsection{Missing tag Detection and identification}
传统丢失标签检测/识别的工作大多依据时间帧中期望时隙状态与真实时隙状态差别判断是否存在丢失标签。当期望中的单一时隙变为真实的空时隙，冲突时隙变为空时隙，冲突时隙变为单一时隙时，可断定RFID系统中存在丢失标签，然而对于丢失标签的识别只能依据期望中的单一时隙和冲突时隙，如果他们对应的真实映射为空时隙，则可断定此时隙所对应的标签丢失，从后台服务器中查询对应标签ID完成丢失标签识别。

冲突分解法也可以实现丢失标签检测与识别。且冲突分解法中的标签不仅能够依据期望的单一时隙和冲突时隙转变为空时隙判断识别丢失标签，而且映射入冲突时隙的冲突标签可以选择自己的区分位进行二次判断识别丢失标签。某一区分位期望状态为$(1)_2$，而实际状态为$(0)_2$时，则可断定对应标签丢失。冲突分解法不仅使时隙利用率提高，还可以有效避免假阳性问题，提高丢失标签检测/识别效率。


\section{协议性能评估}\label{performanceEvaluation_dts}
\esection{Performance Evaluation}
为凸显冲突分解法在未知标签识别中的优越性能，本篇文章引入对比协议UTI-SBF\ucite{chen2018using}、HUTI\ucite{fu2017fast}、PTI\ucite{guo2021priority}、FUTI\ucite{liu2014efficient}，从5 个方面分析各个协议的性能表现，分别为已知标签数量对协议性能的影响、未知标签数量对协议性能的影响、单个已知标签灭活效率、单个未知标签识别效率以及时隙利用率。在仿真实验中，默认已知标签的数量为10000，未知标签的数量为1000，$\omega$的值为0.95。由于PTI\ucite{guo2021priority}是标签识别协议，默认需要搜集所有标签ID，但为了突出对比效果，本文只搜集未知标签ID，已知标签同样被灭活处理。

\subsection{已知标签数量对识别效率的影响}
\esubsection{The efficiency of known tags}
\begin{figure}[t]
    \setlength{\abovecaptionskip}{0pt}
    \setlength{\belowcaptionskip}{0pt}
  \centering
  \includegraphics[width=0.5\textwidth]{Efficiencyofknowntags}
  \bicaption[Efficiencyofknowntags]{}{已知标签数量与识别效率的关系}{Fig.}{Relationship between the number of known tags and recognition efficiency}
\end{figure}

为展示已知标签数量对未知标签数量的影响，仿真设置已知标签的数量从10000到20000，间隔为1000。图~\ref{Efficiencyofknowntags}所示为已知标签数量与识别效率的关系。由图~\ref{Efficiencyofknowntags}可知：
\begin{asparaenum}
\item 已知标签数量越多，达到实验要求所需的时间越长，时效性越低；
\item UTI-SBF协议的性能最差，因为该协议把未知标签的识别分为已知标签灭活和未知标签识别2个过程，已知标签灭活阶段造成时隙浪费，降低了未知标签识别效率；
\item PTI协议与FUTI协议的性能接近，PTI协议虽然能够把冲突时隙变为有用时隙，提高时隙利用率，但已知标签灭活效率仍然很低，且在解决冲突时隙时，造成时间延时；
\item CRM协议的性能最优，当的值为20000，的值为1000时，CRM协议所耗费的时间为51.6s，而HUTI、FUTI、UTI-SBF以及PTI协议所用时间分别为118.8s、85.8s、124.9s、85.2s。CRM协议的时间效率分别是HUTI、PTI协议的2.3倍、1.6倍。
\end{asparaenum}

\subsection{未知标签数量对识别效率的影响}
\esubsection{The efficiency of unknown tags}
\begin{figure}[t]
    \setlength{\abovecaptionskip}{0pt}
    \setlength{\belowcaptionskip}{0pt}
  \centering
  \includegraphics[width=0.5\textwidth]{Efficiencyofunknowntags}
  \bicaption[Efficiencyofunknowntags]{}{未知标签数量与识别效率的关系}{Fig.}{Relationship between the number of unknown tags and recognition efficiency}
\end{figure}

未知标签数量也是影响未知标签识别效率的关键因素之一。在仿真实验中，未知标签数量从1000到2000，间隔100，图~\ref{Efficiencyofunknowntags}所示为未知标签数量与识别效率的关系。

如图~\ref{Efficiencyofunknowntags}所示，可以发现：
\begin{asparaenum}
\item 未知标签数量越多，未知标签识别的效率越低；
\item UTI-SBF协议的效率最差，且随着未知标签数量增多，UTI-SBF协议所用时间递增最快；
\item CRM协议的性能最优，当值为2000时，CRM协议所用时间为33.1s，而HUTI、FUTI、UTI-SBF以及PTI协议所用时间分别为71.2s、50.5s、84.2s、48.2s。CRM协议的识别效率是UTI-SBF协议的2.5倍，是PTI协议的1.4倍。
\end{asparaenum}

\subsection{单个已知标签灭活效率}
\esubsection{The deactivation efficiency of known tags}
\begin{figure}[t]
    \setlength{\abovecaptionskip}{0pt}
    \setlength{\belowcaptionskip}{0pt}
  \centering
  \includegraphics[width=0.5\textwidth]{Deactivationofknonwtags}
  \bicaption[Deactivationofknonwtags]{}{单个已知标签的平均灭活时间}{Fig.}{Average inactivation time of a single known tag}
\end{figure}

已知标签灭活效率是未知标签识别效率的间接体现，已知标签越少对未知标签识别效率的影响越小。图~\ref{Deactivationofknonwtags}所示为不同协议对单个已知标签的平均灭活时间。

由图~\ref{Deactivationofknonwtags}可知：
\begin{asparaenum}
\item 在未知标签数量一定的前提下，已知标签数量增多，单个已知标签灭活时间减小，因为随着已知标签数量增多，未知标签所占比重减小，未知标签对已知标签灭活影响减小；
\item 除了CRM协议，其余协议单个标签的灭活时间都比理想标准Aloha协议上单个标签的灭活时间长，比如当已知标签数量为20000时，PTI协议的单个已知标签灭活时间为4.4ms，而理想状态下灭活单个标签的时间为3.6ms，CRM协议平均灭活一个标签的时间为2.6ms；
\item CRM协议的表现最优，因为该协议可以灭活没有未知标签响应的冲突时隙内的已知标签，当已知标签数量为2000时，CRM协议的单个已知标签的灭活效率是PTI协议的1.6倍，是UTI-SBF协议的2.3倍。
\end{asparaenum}

\subsection{单个未知标签识别效率}
\esubsection{The deactivation efficiency of unknown tags}

\begin{figure}[t]
    \setlength{\abovecaptionskip}{0pt}
    \setlength{\belowcaptionskip}{0pt}
  \centering
  \includegraphics[width=0.5\textwidth]{Deactivationofunknowntags}
  \bicaption[Deactivationofunknowntags]{}{单个未知标签的平均识别时间}{Fig.}{Average recognition time of a single unknown tag}
\end{figure}

\esubsection{The deactivation efficiency of unknown tags}
单个未知标签识别效率是未知标签识别性能好坏的直接体现。通过实验及图~\ref{Deactivationofunknowntags}可以发现：
\begin{asparaenum}
\item 随着未知标签数量增多，单个未知标签识别所需的时间变短。因为已知标签数量一定，未知标签数量增多，未知标签占总标签的比重增大，相对来说，已知标签对未知标签识别影响减小。
\item 所有的未知标签识别协议单个未知标签识别所用时间都比理论时间长，比如当未知标签数量为2 000时，CRM单个未知标签识别的时间为16.8 ms，而理想的识别时间为3.19 ms，已知标签给未知标签的识别造成巨大延迟。
\item CRM协议的性能最优，当未知标签数量为2 000，已知标签数量为10 000时，CRM协议识别一个未知标签所用时间为16.8 ms，而HUTI、FUTI、UTI-SBF及PTI协议所用时间分别为37.4 ms、26.3 ms、42.1 ms、24.9 ms，也就是说CRM协议的单个未知标签识别效率是PTI协议的1.4倍，是UTI-SBF协议的2.5倍。
\end{asparaenum}


\subsection{时隙利用率}
\esubsection{The utilization of slots}
\begin{figure}[t]
    \setlength{\abovecaptionskip}{0pt}
    \setlength{\belowcaptionskip}{0pt}
  \centering
  \includegraphics[width=0.5\textwidth]{utilizationofslots}
  \bicaption[utilizationofslots]{}{时隙利用率}{Fig.}{Utilization rate of slots}
\end{figure}

时隙利用率也是衡量协议性能的关键因素之一。图~\ref{utilizationofslots}为当未知标签数量一定，未知标签数量对时隙利用率的影响。由图~\ref{utilizationofslots}可以发现：
\begin{asparaenum}
\item 已知标签数量对时隙利用率的影响较小，当已知标签数量从10 000增加到20 000时，各协议时隙利用率基本保持不变； 
\item CRM协议的时隙利用率最高，为86.5\%，而HUTI、FUTI、UTI-SBF、以及PTI协议的时隙利用率分别为37.2\%、36.7\%、25\%、68.8\%。
\end{asparaenum}

\section{本章小结}\label{Conclusion_dts}
\esection{Chapter Conclusion}
本章研究了大规模RFID系统中未知标签快速识别问题。基于现有的未知标签识别协议大多存在冲突时隙被直接废弃、时隙利用率低的问题，本章设计冲突分解协议(CRM)，通过引入区分码把冲突时隙转变为可识别未知标签的时隙，提高时隙利用率及未知标签的识别效率。实验结果表明，CRM协议的未知标签识别
效率是UTI-SBF 协议的2.3倍。虽然CRM协议的性能得到很大提升，但CRM解决冲突时隙时，只是对未知标签进行识别，无法灭活混合冲突时隙中的已知标签，因此下一步将研究快速分离混合冲突时隙中的已知标签问题，实现已知标签更快速的灭活，提高未知标签的识别效率。









